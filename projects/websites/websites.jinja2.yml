website-koen:
  container_name: website-koen
  image: nginx:alpine
  depends_on:
    - traefik
    - php-fpm
  restart: unless-stopped
  environment:
    - TZ={{ global.timezone }}
  volumes:
    - /etc/localtime:/etc/localtime:ro
    - {{ global.docker_volume }}/websites/{{ websites.domain_koen }}/config:/etc/nginx/conf.d:ro
    - {{ global.docker_volume }}/websites/{{ websites.domain_koen }}/logs:/var/log/nginx
    - {{ global.docker_volume }}/websites/{{ websites.domain_koen }}/public:/usr/share/nginx/html:ro
  healthcheck:
    test: ["CMD", "curl", "-f", "http://localhost/"]
    interval: 30s
    timeout: 5s
  labels:
    - "autoheal=true"
    - "traefik.enable=true"
    - "traefik.http.services.website-koen.loadbalancer.server.port=80"
    - "traefik.http.routers.website-koen.entrypoints=external"
    - "traefik.http.routers.website-koen.rule=Host(`{{ websites.domain_koen }}`)"
    - "traefik.http.routers.website-koen.tls=true"
    - "traefik.http.routers.website-koen.tls.certresolver=letsencrypt"
    - "traefik.http.middlewares.website-koen-geoip.forwardauth.address=http://localhost:8000/?locations={{ websites.allowed_countries|join(';') }}&ips={{ global.internal_ips|join(',') }}"
    - "traefik.http.routers.website-koen.middlewares=website-koen-geoip@docker"
website-paul:
  container_name: website-paul
  image: nginx:alpine
  depends_on:
    - traefik
  restart: unless-stopped
  environment:
    - TZ={{ global.timezone }}
  volumes:
    - /etc/localtime:/etc/localtime:ro
    - {{ global.docker_volume }}/websites/{{ websites.domain_paul }}/config:/etc/nginx/conf.d:ro
    - {{ global.docker_volume }}/websites/{{ websites.domain_paul }}/logs:/var/log/nginx
    - {{ global.docker_volume }}/websites/{{ websites.domain_paul }}/public:/usr/share/nginx/html:ro
  healthcheck:
    test: ["CMD", "curl", "-f", "http://localhost/"]
    interval: 30s
    timeout: 5s
  labels:
    - "autoheal=true"
    - "traefik.enable=true"
    - "traefik.http.services.website-paul.loadbalancer.server.port=80"
    - "traefik.http.routers.website-paul.entrypoints=external"
    - "traefik.http.routers.website-paul.rule=Host(`{{ websites.domain_paul }}`)"
    - "traefik.http.routers.website-paul.tls=true"
    - "traefik.http.routers.website-paul.tls.certresolver=letsencrypt"
    - "traefik.http.middlewares.website-paul-geoip.forwardauth.address=http://localhost:8000/?locations={{ websites.allowed_countries|join(';') }}&ips={{ global.internal_ips|join(',') }}"
    - "traefik.http.routers.website-paul.middlewares=website-paul-geoip@docker"
